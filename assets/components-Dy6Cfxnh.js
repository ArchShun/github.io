import{d as Z,m as Fe,u as ce,r as C,a as De,b as N,c as y,o as u,e as S,F as I,f as H,g as T,n as j,h as q,i as g,t as U,j as ue,k as de,s as pe,l as oe,p as we,w as J,v as X,q as V,x as le,y as b,z as O,A as he,E as D,B as $e,C as Ee,D as xe,G,M as Me,H as Ne,I as Ae,J as ge,K as Pe,L as Te,N as Oe,O as se,P as ne,Q as ae}from"./vendor-CffigfLb.js";const Le=[{name:"宋体",value:"宋体, SimSun, Songti SC"},{name:"微软雅黑",value:"微软雅黑, Microsoft YaHei"},{name:"楷体",value:"楷体, 楷体_GB2312, SimKai, STKaiti"},{name:"黑体",value:"黑体, SimHei, Heiti SC"},{name:"隶书",value:"隶书, SimLi"},{name:"Andale Mono",value:"andale mono"},{name:"Arial",value:"arial, helvetica, sans-serif"},{name:"arialBlack",value:"arial black, avant garde"},{name:"Comic Sans Ms",value:"comic sans ms"},{name:"Impact",value:"impact, chicago"},{name:"Times New Roman",value:"times new roman"},{name:"Sans-Serif",value:"sans-serif"},{name:"serif",value:"serif"}],Ie=[10,12,16,18,24,32,48],Be=["#4D4D4D","#999999","#FFFFFF","#F44E3B","#FE9200","#FCDC00","#DBDF00","#A4DD00","#68CCCA","#73D8FF","#AEA1FF","#FDA1FF","#333333","#808080","#cccccc","#D33115","#E27300","#FCC400","#B0BC00","#68BC00","#16A5A5","#009CE0","#7B64FF","#FA28FF","#000000","#666666","#B3B3B3","#9F0500","#C45100","#FB9E00","#808900","#194D33","#0C797D","#0062B1","#653294","transparent"];navigator.platform.toUpperCase().indexOf("MAC")>=0;const Ve=[{name:"Song Ti",value:"宋体, SimSun, Songti SC"},{name:"Microsoft Yahei",value:"微软雅黑, Microsoft YaHei"},{name:"Italics",value:"楷体, 楷体_GB2312, SimKai, STKaiti"},{name:"Boldface",value:"黑体, SimHei, Heiti SC"},{name:"Official script",value:"隶书, SimLi"},{name:"Andale Mono",value:"andale mono"},{name:"Arial",value:"arial, helvetica, sans-serif"},{name:"arialBlack",value:"arial black, avant garde"},{name:"Comic Sans Ms",value:"comic sans ms"},{name:"Impact",value:"impact, chicago"},{name:"Times New Roman",value:"times new roman"},{name:"Sans-Serif",value:"sans-serif"},{name:"serif",value:"serif"}];navigator.platform.toUpperCase().indexOf("MAC")>=0;const ye={zh:Le,en:Ve},Re={class:"colorContainer"},Ue={class:"colorList"},We=["onClick"],Ge={class:"moreColor"},He=Z({__name:"ColorPicker",props:{color:{default:"#ffffff"},colorModifiers:{}},emits:Fe(["change"],["update:color"]),setup(n,{emit:a}){const{t}=ce(),s=C(),i=a,r=De(n,"color");return(e,w)=>{const v=N("el-color-picker");return u(),y("div",Re,[S("div",Ue,[(u(!0),y(I,null,H(T(Be),f=>(u(),y("span",{class:q(["colorItem",{icontouming:f==="transparent"}]),style:j({backgroundColor:f}),key:f,onClick:()=>(r.value=f,i("change",r.value))},null,14,We))),128))]),S("div",Ge,[S("span",{onClick:w[0]||(w[0]=()=>s.value.show())},U(T(t)("color.moreColor")),1),g(v,{ref_key:"picker",ref:s,tabindex:1,onChange:w[1]||(w[1]=f=>i("change",f)),size:"small",modelValue:r.value,"onUpdate:modelValue":w[2]||(w[2]=f=>r.value=f),teleported:!1},null,8,["modelValue"])])])}}}),ee=(n,a)=>{const t=n.__vccOpts||n;for(const[s,i]of a)t[s]=i;return t},_e=ee(He,[["__scopeId","data-v-9509deae"]]);async function ke(n){return new Promise(a=>{setTimeout(a,n)})}const me=ue("main",()=>{let n=null;const a=de(()=>n);function t(i){n?n.setFullData(i.getData(!0)):n=i}async function s(i){if(typeof i!="object")throw new Error("fileContentError");i.root?(n.setFullData(i),await ke(1500),n.setFullData(i)):(n.setData(i),await ke(1500),n.setData(i))}return{mindMap:a,setMindMap:t,loadData:s}}),je=["onClick"],ze=["onMouseenter"],Je={class:"remix"},qe=["xlink:href"],Ke=["onClickPassive"],Xe=["onClickPassive"],Ye=["onClickPassive"],Qe=["xlink:href"],Ze=Z({__name:"RichTextToolbar",setup(n){const{mindMap:a}=pe(me()),{locale:t}=ce(),s=oe([{icon:"bold",title:"Bold",action:()=>e.value.bold=!e.value.bold,isActive:()=>e.value.bold},{icon:"italic",title:"Italic",action:()=>e.value.italic=!e.value.italic,isActive:()=>e.value.italic},{icon:"strikethrough",title:"Strike",action:()=>e.value.strike=!e.value.strike,isActive:()=>e.value.strike},{icon:"underline",title:"Underline",action:()=>e.value.underline=!e.value.underline,isActive:()=>e.value.underline},{icon:"font-family",title:"Font Family",action:$=>e.value.font=$},{icon:"font-size",title:"Font Size",action:$=>e.value.size=$},{icon:"mark-pen-line",title:"Highlight"},{icon:"font-color",title:"Font Color"},{icon:"eraser-line",title:"Clear Format",action:()=>(e.value={},a.value.richText.removeFormat())}]),i=oe({left:"0px",top:"0px"}),r=C(!1),e=C({}),w=de(()=>ye[t.value]||ye.zh);we(()=>{a.value.on("rich_text_selection_change",v),a.value.on("svg_mousedown",()=>A.value=!1)});function v($,_,P){$&&(i.left=_.left+_.width/2+"px",i.top=`calc(${_.top}px - 2.5rem)`,Array.isArray(P.background)&&(P.background=P.background[0]),Array.isArray(P.color)&&(P.color=P.color[0]),e.value={...P||{}},r.value=!0),A.value||(r.value=$,F.value="")}function f($,..._){var P;(P=$.action)==null||P.call($,..._),a.value.richText.formatText(e.value)}const F=C(""),A=C(!1);return($,_)=>{const P=N("el-popover"),K=N("el-tooltip"),R=N("el-divider");return J((u(),y("div",{class:"menubar",style:j(i)},[(u(!0),y(I,null,H(s,(k,z)=>(u(),y("div",{key:`${k}_${z}`,onClick:x=>console.log(k.title)},[["Font Family","Font Size","Font Color","Highlight"].includes(k.title)?(u(),V(P,{key:0,placement:"top",width:"12rem",visible:F.value==k.title,"popper-class":"el-popper__no_pandding el-popper__top"},{reference:b(()=>[S("button",{class:"menu-item",onMouseenter:()=>F.value=k.title},[(u(),y("svg",Je,[S("use",{"xlink:href":`${T(he)}#ri-${k.icon}`},null,8,qe)]))],40,ze)]),default:b(()=>[S("div",{onMouseenter:_[2]||(_[2]=()=>A.value=!0),onMouseleave:_[3]||(_[3]=()=>A.value=!1),onClickPassive:_[4]||(_[4]=O(()=>{var x;return(x=T(a).richText)==null?void 0:x.setSelectLast()},["stop"]))},[(u(!0),y(I,null,H(w.value,x=>J((u(),y("div",{style:j(`font-family: ${x.name}`),class:"select-item",onClickPassive:O(()=>f(k,x.value),["stop"]),key:x},U(x.name),45,Ke)),[[X,k.title=="Font Family"]])),128)),(u(!0),y(I,null,H(T(Ie),x=>J((u(),y("div",{onClickPassive:O(()=>f(k,`${x}px`),["stop"]),key:x,style:j(`font-size: ${x}px`),class:"select-item"},U(x)+"px ",45,Xe)),[[X,k.title=="Font Size"]])),128)),J(g(_e,{color:e.value.color,"onUpdate:color":_[0]||(_[0]=x=>e.value.color=x),onChange:()=>f(k)},null,8,["color","onChange"]),[[X,k.title=="Font Color"]]),J(g(_e,{color:e.value.background,"onUpdate:color":_[1]||(_[1]=x=>e.value.background=x),onChange:()=>f(k)},null,8,["color","onChange"]),[[X,k.title=="Highlight"]])],32)]),_:2},1032,["visible"])):(u(),V(K,{key:1,placement:"bottom",effect:"light",content:k.title,"popper-class":"el-popper__top"},{default:b(()=>[S("button",{onClickPassive:O(()=>f(k),["stop"]),class:q(["menu-item",{"is-active":k.isActive?k.isActive():null}])},[(u(),y("svg",{class:"remix",onMouseenter:_[5]||(_[5]=()=>F.value="")},[S("use",{"xlink:href":`${T(he)}#ri-${k.icon}`},null,8,Qe)],32))],42,Ye)]),_:2},1032,["content"])),z<s.length-1?(u(),V(R,{key:2,direction:"vertical","border-style":"dashed"})):le("",!0)],8,je))),128))],4)),[[X,r.value||A.value]])}}}),$t=ee(Ze,[["__scopeId","data-v-b16da117"]]),et=["onClickPassive"],tt={class:"name sub-name"},nt=["onClickPassive"],at={class:"name"},ot={class:"desc"},lt={class:"name"},it={class:"desc"},st=Z({__name:"SvgContextMenu",setup(n){const a=me(),{mindMap:t}=pe(a),{t:s}=ce(),i=C(!1),r=C(!1),e=C(null),w=C(null),v=oe({x:0,y:0}),f=oe({}),F=C(!1),A=C({url:"",title:"",width:100,height:100}),$=[{name:"insertSiblingNode",cutkey:"Enter",action:()=>t.value.execCommand("INSERT_NODE")},{name:"insertChildNode",cutkey:"Tab",action:()=>t.value.execCommand("INSERT_CHILD_NODE")},{name:"insertParentNode",cutkey:"Shift + Tab",action:()=>t.value.execCommand("INSERT_PARENT_NODE")},{name:"insertSummary",action:()=>t.value.execCommand("ADD_GENERALIZATION")},{name:"splitLine"},{name:"insertImage",action:()=>(R(),F.value=!0)},{name:"addNote",action:()=>{e.value.setNote(""),console.log(e.value)}},{name:"splitLine"},{name:"moveUpNode",cutkey:"Ctrl + ↑",action:()=>t.value.execCommand("UP_NODE")},{name:"moveDownNode",cutkey:"Ctrl + ↓",action:()=>t.value.execCommand("DOWN_NODE")},{name:"moveUpOneLevel",cutkey:"",action:()=>t.value.execCommand("MOVE_UP_ONE_LEVEL")},{name:"deleteNode",cutkey:"Delete",action:()=>t.value.execCommand("REMOVE_NODE")},{name:"deleteCurrentNode",cutkey:"Shift + Backspace",action:()=>t.value.execCommand("REMOVE_CURRENT_NODE")},{name:"splitLine"},{name:"copyNode",cutkey:"Ctrl + C",action:()=>t.value.renderer.copy()},{name:"cutNode",cutkey:"Ctrl + X",action:()=>t.value.renderer.cut()},{name:"pasteNode",cutkey:"Ctrl + V",action:()=>t.value.renderer.paste()},{name:"splitLine"},{name:"exportNodeToPng",cutkey:"",action:x}],_=de(()=>{const h=[];for(let m=0;m<6;m++)h.push({name:`level${m+1}`,children:[],action:()=>t.value.execCommand("UNEXPAND_TO_LEVEL",m+1)});return h}),P=[{name:"expandAll",cutkey:"",action:()=>t.value.execCommand("EXPAND_ALL")},{name:"unExpandAll",cutkey:"",action:()=>t.value.execCommand("UNEXPAND_ALL")},{name:"expandTo",cutkey:"",children:_.value},{name:"arrangeLayout",cutkey:"Ctrl + L",action:()=>t.value.execCommand("RESET_LAYOUT")},{name:"fitCanvas",cutkey:"Ctrl + i",action:()=>t.value.view.fit(()=>{},!1,null)},{name:"repairFormula",cutkey:"",action:()=>(t.value.formula.repairFormula(),D.success("修复公式成功"),R())}];we(()=>{t.value.on("node_contextmenu",z),t.value.on("contextmenu",h=>k(h.clientX,h.clientY)),t.value.on("svg_mousedown",R)});function K(h,m){const o=w.value.getBoundingClientRect();return h+o.width>window.innerWidth&&(h=h-o.width-20),m+o.height>window.innerHeight&&(m=window.innerHeight-o.height-10),{x:h,y:m}}function R(){i.value&&(i.value=!1,f.isMousedown=!1,r.value=!1,e.value=null)}function k(h,m){v.x=h,v.y=m,i.value=!0,$e(()=>Object.assign(v,K(v.x,v.y)))}function z(h,m){e.value=m,r.value=!0,k(h.clientX,h.clientY)}function x(){const h=e.value;t.value.doExport.png("",null,h).then(m=>{Ee(m,xe(h==null?void 0:h.getData("text")))}).catch(m=>{console.error(m),D.error("导出失败"),R()})}function W(){if(A.value.url.length===0)return D.warning("请先选择图片或输入 URL");e.value.setImage({...A.value}),F.value=!1}function ie(h,m){console.log(h,m);const o=new FileReader;o.onload=l=>{var d;A.value.url=((d=l.target)==null?void 0:d.result)??"",A.value.title=h.name},o.readAsDataURL(h.raw)}return(h,m)=>{const o=N("el-divider"),l=N("el-popover"),d=N("el-image"),p=N("el-upload"),E=N("el-button"),B=N("el-dialog");return u(),y(I,null,[i.value?(u(),y("div",{key:0,onMouseup:O(c=>{},["middle","prevent"]),onContextmenu:O(c=>{},["right","prevent"]),class:"contextmenuContainer listBox",ref_key:"contextmenuRef",ref:w,style:j({left:v.x+"px",top:v.y+"px"})},[(u(!0),y(I,null,H(r.value?$:P,(c,M)=>{var ve;return u(),y("div",{class:"item",key:c.name+"_"+M,onClickPassive:O(()=>{var L;return((L=c==null?void 0:c.action)==null?void 0:L.call(c))||R()},["left","stop"])},[c.name==="splitLine"?(u(),V(o,{key:0})):(u(),y(I,{key:1},[c!=null&&c.children?(u(),V(l,{key:0,width:((ve=c==null?void 0:c.children)==null?void 0:ve.findIndex(L=>L.cutkey))>-1?"200px":"60px",trigger:"hover",placement:"right-start",persistent:!1},{reference:b(()=>[S("div",tt,U(T(s)("contextmenu."+c.name)),1)]),default:b(()=>[(u(!0),y(I,null,H(c.children,L=>(u(),y("div",{class:"item",key:L.name,onClickPassive:O(()=>{var fe;return((fe=L==null?void 0:L.action)==null?void 0:fe.call(L))||R()},["left","stop"])},[S("span",at,U(T(s)("contextmenu."+L.name)),1),S("span",ot,U(L.cutkey),1)],40,nt))),128))]),_:2},1032,["width"])):(u(),y(I,{key:1},[S("span",lt,U(T(s)("contextmenu."+c.name)),1),S("span",it,U(c.cutkey),1)],64))],64))],40,et)}),128))],36)):le("",!0),g(B,{modelValue:F.value,"onUpdate:modelValue":m[1]||(m[1]=c=>F.value=c),width:"800"},{footer:b(()=>[g(E,{type:"primary",onClick:W},{default:b(()=>m[3]||(m[3]=[G("确定")])),_:1}),g(E,{type:"default",onClick:m[0]||(m[0]=c=>F.value=!1)},{default:b(()=>m[4]||(m[4]=[G("取消")])),_:1})]),default:b(()=>{var c;return[((c=A.value.url)==null?void 0:c.length)>0?(u(),V(d,{key:0,style:{width:"100px",height:"100px"},src:A.value.url},null,8,["src"])):(u(),V(p,{key:1,class:"upload-demo",drag:"",multiple:"","auto-upload":!1,limit:1,"on-change":ie,"show-file-list":!1},{default:b(()=>m[2]||(m[2]=[S("div",{class:"el-upload__text"},[G("Drop file here or "),S("em",null,"click to upload")],-1)])),_:1}))]}),_:1},8,["modelValue"])],64)}}}),Et=ee(st,[["__scopeId","data-v-36dc876b"]]);async function rt(){const n=localStorage.getItem("settings");return n?JSON.parse(n):{}}async function ct(n){localStorage.setItem("settings",JSON.stringify(n))}const Ce={getSettings:rt,saveSettings:ct};let Q=null;async function ut(n){return new Promise((a,t)=>{const s=new FileReader;s.onload=()=>{a(s.result)},s.onerror=()=>{t(s.error)},s.readAsText(n)})}async function dt(){const n=new Me({el:document.getElementById("mindMapContainer"),data:{data:{text:"根节点"},children:[]}});return await re(n),n}async function pt(){if(!window.showOpenFilePicker)throw new Error("File picker API not available");Q=(await window.showOpenFilePicker({types:[{description:"",accept:{"application/json":[".smm"]}}],excludeAcceptAllOption:!0}))[0];const a=await Q.getFile(),t=await ut(a);return JSON.parse(t)}async function re(n){const a=JSON.stringify(n.getData(!0));try{if(!Q){if(!window.showSaveFilePicker)throw new Error("File saver API not available");Q=await window.showSaveFilePicker({suggestedName:"mindmap.smm",types:[{description:"",accept:{"application/json":[".smm"]}}]})}const t=await Q.createWritable();await t.write(a),await t.close()}catch(t){console.error("Error saving data:",t instanceof Error?t.message:"unknown error")}}const mt=ue("settings",()=>{const n={access_token:"",api_url:"https://gitee.com/api/v5/repos",owner:"",repo:"",ref:"master",branch:"master"},a=C({language:"zh-CN",github:{}});return{settings:a,init:()=>{Ce.getSettings().then(i=>{a.value={...i}})},setGithub:i=>{a.value.github={...n,...i},Ce.saveSettings(a.value)}}}),vt=ue("state",()=>{const n=C(!1);async function a(t,...s){try{n.value=!0;const i=t(...s);return i instanceof Promise?await i:i}finally{n.value=!1}}return{loading:n,loadingWapper:a}}),ft=["onDblclick"],ht={class:"title",style:{margin:"0.5rem"}},gt={class:"title",style:{margin:"0.5rem"}},yt=Z({name:"DynamicMenu",__name:"DynamicMenuItem",props:{id:{type:String,required:!0},menuData:{type:Array,required:!0}},setup(n){return(a,t)=>{const s=N("DynamicMenu"),i=N("el-sub-menu"),r=N("el-menu-item");return u(!0),y(I,null,H(n.menuData,(e,w)=>(u(),y(I,{key:w},[e.children?(u(),V(i,{key:0,index:`${n.id}/${e.id}`},{title:b(()=>[S("div",{style:j(e.style),class:"custom-menu-item",onDblclick:O(()=>{var v;return(v=e.dbclick)==null?void 0:v.call(e,e,`${n.id}/${e.id}`)},["stop","prevent"])},[e.icon?(u(),y("i",{key:0,class:q(`ri-${e.icon}`)},null,2)):le("",!0),S("span",ht,U(e.title),1)],44,ft)]),default:b(()=>{var v;return[S("div",{class:q(`${(((v=e.children)==null?void 0:v.length)??0)>10?"max-height-10":""}`)},[g(s,{"menu-data":e.children,id:`${n.id}/${e.id}`},null,8,["menu-data","id"])],2)]}),_:2},1032,["index"])):(u(),V(r,{key:1,index:`${n.id}/${e.id}`,onDblclick:O(()=>{var v;return(v=e.dbclick)==null?void 0:v.call(e,e,`${n.id}/${e.title}`)},["stop","prevent"])},{default:b(()=>[S("div",{class:"custom-menu-item",style:j(e.style)},[e.render?(u(),V(Ne(e.render),{key:0})):(u(),y(I,{key:1},[e.icon?(u(),y("i",{key:0,class:q(`ri-${e.icon}`)},null,2)):le("",!0),S("span",gt,U(e.title),1)],64))],4)]),_:2},1032,["index","onDblclick"]))],64))),128)}}}),_t=ee(yt,[["__scopeId","data-v-b7e3887b"]]),te=Ae.create({headers:{"Content-Type":"application/json"}});te.interceptors.response.use(n=>n.data,n=>Promise.reject(n));function be(n){return btoa(new TextEncoder().encode(n).reduce((a,t)=>a+String.fromCharCode(t),""))}function kt(n){return new TextDecoder().decode(Uint8Array.from(atob(n),a=>a.charCodeAt(0)))}async function Se(n,a){const{api_url:t,ref:s,owner:i,access_token:r,repo:e}=n;if(!t||!i||!e||!r)throw new Error("Invalid Github settings");const w=`${t}/${i}/${e}/contents/${a}?access_token=${r}&ref=${s??""}`;return te.get(w)}async function Ct(n,a){const t=await Se(n,a);if(!Array.isArray(t))throw new Error("Check the path or Github settings.");return t}async function wt(n,a){const t=await Se(n,a);if(Array.isArray(t))throw new Error("Check the path or Github settings.");return kt(t.content)}async function xt(n,a,t,s="create file by mind map math online."){const{api_url:i,owner:r,repo:e,access_token:w}=n,v=`${i}/${r}/${e}/contents/${a}`,f=be(JSON.stringify(t.getData(!0)));return(await te.post(v,{access_token:w,content:f,message:s})).content}async function bt(n,a,t,s,i="update file by mind map math online."){const{api_url:r,owner:e,repo:w,access_token:v}=n,f=`${r}/${e}/${w}/contents/${a}`,F=be(JSON.stringify(s.getData(!0))),A={access_token:v,content:F,sha:t,branch:n.branch??"master",message:i};return(await te.put(f,A)).content}async function St(n,a,t,s="delete file by mind map math online."){const{api_url:i,owner:r,repo:e,access_token:w}=n,v=`${i}/${r}/${e}/contents/${a}`,f={access_token:w,sha:t,branch:n.branch??"master",message:s};return te.delete(v,{data:f})}const Y={getList:Ct,createFile:xt,updateFile:bt,getContent:wt,deleteFile:St},Ft=Z({__name:"MenuToolbar",setup(n){const a=vt(),t=me(),s=mt(),{mindMap:i}=pe(t),r=C({showDialog:!1,data:{access_token:"",owner:"",repo:""},show(){r.value.showDialog=!0;const{access_token:o,owner:l,repo:d}=s.settings.github;r.value.data={access_token:o,owner:l,repo:d}},confirm(){const{access_token:o,owner:l,repo:d}=r.value.data;if(!o||!l||!d)return D.error("请填写完整信息");s.setGithub({access_token:o,owner:l,repo:d}),r.value.showDialog=!1},cancel(){r.value.showDialog=!1}}),e=C(!0),w=C(),v=C(!1),f=C(null),F=C(null),A=C([]),$=C([{id:"local",title:"本地文件",icon:"file-line",children:[{id:"create",title:"新建",icon:"sticky-note-add-line",meta:{action:()=>a.loadingWapper(dt).then(o=>t.setMindMap(o))}},{id:"open",title:"打开",icon:"folder-open-line",meta:{action:P}},{id:"save",title:"保存",icon:"save-line",meta:{action:()=>a.loadingWapper(re,i.value)}}]},{id:"cloud",title:"云端存储",icon:"cloud-line",children:[{id:"create",title:"新建",icon:"sticky-note-add-line",meta:{action:()=>a.loadingWapper(R)}},{id:"submit",title:"提交修改",icon:"git-commit-line",meta:{action:()=>a.loadingWapper(k)}},{id:"branch",title:s.settings.github.branch||"master",icon:"git-branch-line",children:A.value,meta:{load:!1}}]},{id:"import-export",title:"导入导出",icon:"download-cloud-line",children:[{id:"exportPng",title:"导出 png",icon:"export-line",meta:{action:()=>a.loadingWapper(K)}}]},{id:"options",title:"设置",icon:"settings-3-line",children:[{id:"github",title:"Gitee",icon:"github-line",meta:{action:r.value.show}},{id:"theme",title:"主题",icon:"sun-line",children:[{id:"dark",title:"暗黑模式",icon:"moon-line"}]}]}]),_=C(null);function P(){_.value||clearInterval(_.value),pt().then(o=>{a.loadingWapper(t.loadData,o).then(()=>{_.value=setInterval(()=>{re(i.value).then(()=>{D.info("自动保存成功")})},6e4)})})}function K(){i.value.export("png",!0,xe(i.value.getData(!0).root.data.text))}async function R(){var d;if(!s.settings.github.branch)return D.error("请先配置 Gitee 仓库信息");const o=((d=f.value)==null?void 0:d.split("/").filter(p=>p!==""))??[],l=C(o.length>2?o.slice(2).join("/"):"");ge({title:"新建云端文件",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",message:()=>se("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},[se(ne,{modelValue:l.value,"onUpdate:modelValue":p=>{l.value=p},placeholder:"请输入文件名"}),se("span",{style:{marginLeft:"10px"}},".smm")])}).then(()=>{Y.createFile(s.settings.github,`${l.value}.smm`,i.value).then(()=>{D.success("新建成功"),W("/cloud/branch").at(-1).meta.load=!1,m("/cloud/branch",!0)}).catch(p=>D.error("新建失败:"+p))}).catch()}async function k(){if(!F.value)return D.error("请先打开云端文件");const{sha:o,path:l}=F.value;ge.prompt("Please input your message","Submit",{confirmButtonText:"OK",cancelButtonText:"Cancel",inputValue:"update by mind map math online"}).then(({value:d})=>{Y.updateFile(s.settings.github,l,o,i.value,d).then(p=>{F.value={...F.value,...p},D.success("保存成功")}).catch(p=>D.error("保存失败:"+p))}).catch(()=>{})}async function z(o){var B;const l=o.path.split("/"),d=`/cloud/branch/${l.slice(0,l.length-1).join("/")}`,p=((B=W(d).at(-1))==null?void 0:B.children)??[],E=p.findIndex(c=>{var M;return((M=c.meta)==null?void 0:M.sha)===o.sha});if(E===void 0||E===-1)return D.error(`搜索路径失败：${d}`);Y.deleteFile(s.settings.github,o.path,o.sha).then(()=>{p==null||p.splice(E,1),D.success("删除成功")}).catch(c=>D.error("删除失败:"+c))}function x(o){Y.getContent(s.settings.github,o.path).then(l=>a.loadingWapper(t.loadData,JSON.parse(l)).then(()=>{F.value=o,D.success("打开成功")})).catch(l=>{D.error("打开失败:"+l),F.value=null})}function W(o){const l=o.replace(/^\//g,"").replace(/\/$/g,"").split("/");let d=$.value;const p=[];for(;l.length>0;){const E=l.shift(),B=d.find(c=>c.id===E)??null;if(B==null)throw D.error("未找到路径: "+E),new Error("未找到路径: "+E);p.push(B),d=B.children??[]}return p}async function ie(o){var d,p,E;const l=W(o);(E=(p=(d=l.at(-1))==null?void 0:d.meta)==null?void 0:p.action)==null||E.call(p,l.at(-1),o)}function h(o){const l={id:o.name,icon:o.type==="dir"?"folder-line":"file-line",title:o.name,meta:{...o,load:!1}};return o.type==="dir"?l.children=[]:(l.dbclick=()=>a.loadingWapper(x,o),l.render=()=>g(Oe,{width:"auto",placement:"right",trigger:"hover"},{reference:()=>{var d;return g("div",{style:((d=F.value)==null?void 0:d.path)===o.path?{color:"coral",fontWeight:"bold"}:{color:"none",fontWeight:"none"}},[g("i",{class:"ri-file-line"},null),g("span",{class:"title",style:"margin-left: 0.5rem;"},[o.name])])},default:()=>g("div",null,[g(ae,{plain:!0,size:"small",type:"success",onClick:()=>a.loadingWapper(x,o)},{default:()=>[G("打开")]}),g(ae,{plain:!0,size:"small",type:"warning",onClick:()=>a.loadingWapper(z,o)},{default:()=>[G("删除")]})])})),l}async function m(o,l){if(f.value&&W(f.value).forEach(p=>p.style={fontWeight:void 0}),f.value=o,!o.startsWith("/cloud"))return;const d=W(o);if(!(d.length<2)&&d[0].id==="cloud"&&d.length>1&&d[1].id==="branch"){if(!s.settings.github.branch)return D.error("请先配置 Gitee 仓库信息");const p=d[d.length-1];if(p.style={fontWeight:"bold"},l&&!p.meta.load){v.value=!0;const E=d.splice(2).map(c=>c.title).join("/"),B=await Y.getList(s.settings.github,E).finally(()=>v.value=!1);p.children=B.filter(c=>c.type==="dir"||c.name.endsWith(".smm")).map(h),p.meta.load=!0}}}return C(),Pe(()=>s.settings.github,o=>{r.value.data={...r.value.data,...o}}),(o,l)=>{const d=N("el-menu"),p=N("el-form-item"),E=N("el-form"),B=N("el-dialog"),c=Te("loading");return u(),y(I,null,[S("div",{class:"menu-toolbar",onClickPassive:O(M=>{},["stop"])},[J((u(),V(d,{ref_key:"menuRef",ref:w,collapse:e.value,onOpen:l[0]||(l[0]=M=>m(M,!0)),onClose:l[1]||(l[1]=M=>m(M,!1)),onSelect:ie},{default:b(()=>[g(_t,{"menu-data":$.value,id:""},null,8,["menu-data"])]),_:1},8,["collapse"])),[[c,v.value]]),S("i",{class:q(["collapse-icon",`ri-arrow-${e.value?"right":"left"}-double-line`]),onClickPassive:l[2]||(l[2]=O(()=>e.value=!e.value,["stop"]))},null,34)],32),g(B,{modelValue:r.value.showDialog,"onUpdate:modelValue":l[6]||(l[6]=M=>r.value.showDialog=M),title:"Gitee 同步",width:"600"},{default:b(()=>[g(E,null,{default:b(()=>[g(p,{label:"用户授权码","label-width":"140px",required:""},{default:b(()=>[g(T(ne),{modelValue:r.value.data.access_token,"onUpdate:modelValue":l[3]||(l[3]=M=>r.value.data.access_token=M),placeholder:'进入"设置" > "私人令牌" > "生成新令牌" 获取',autocomplete:"off"},null,8,["modelValue"])]),_:1}),g(p,{label:"仓库所属空间地址","label-width":"140px",required:""},{default:b(()=>[g(T(ne),{modelValue:r.value.data.owner,"onUpdate:modelValue":l[4]||(l[4]=M=>r.value.data.owner=M),placeholder:"企业、组织或个人的地址 path",autocomplete:"off"},null,8,["modelValue"])]),_:1}),g(p,{label:"仓库名称","label-width":"140px",required:""},{default:b(()=>[g(T(ne),{modelValue:r.value.data.repo,"onUpdate:modelValue":l[5]||(l[5]=M=>r.value.data.repo=M),placeholder:"默认为 master",autocomplete:"off"},null,8,["modelValue"])]),_:1}),g(p,null,{default:b(()=>[g(T(ae),{type:"primary",onClickPassive:O(r.value.confirm,["stop"])},{default:b(()=>l[7]||(l[7]=[G("确定")])),_:1},8,["onClickPassive"]),g(T(ae),{type:"warning",onClickPassive:O(r.value.cancel,["stop"])},{default:b(()=>l[8]||(l[8]=[G("取消")])),_:1},8,["onClickPassive"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),Mt=ee(Ft,[["__scopeId","data-v-839ae046"]]);export{Mt as M,$t as R,Et as S,ee as _,me as a,mt as b,vt as u};
//# sourceMappingURL=components-Dy6Cfxnh.js.map
